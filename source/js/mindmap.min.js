$(document).ready(function(){$(".mindmap").each(function(){MM_FUNCS.drawMindMap(this,this)});
                             var centerwin=$("#mindmap-window");
                             $(".mindmap").dblclick(function(){$('#container').addClass('blur');centerwin.show();MM_FUNCS.drawMindMap(centerwin[0], this);setTimeout(function() {centerwin.css("background",'rgba(255,255,255,0.7)');}, 10);}) // delay 10 的目标是让 kityminder 的默认渲染先运行完，再更改颜色
                             centerwin.dblclick(function() {$('#container').removeClass('blur');centerwin.hide();});})

var MM_FUNCS={li2jsonData:function(c){var a;var b=c.children("a:first");if(b.length!==0){a={"data":{"text":b.text(),"hyperlink":b.attr("href")}}}else{a={"data":{"text":c[0].childNodes[0].nodeValue.trim()}}}c.find("> ul > li").each(function(){if(!a.hasOwnProperty("children")){a.children=[]}a.children.push(MM_FUNCS.li2jsonData($(this)))});return a},drawMindMap:function(target,source){var d=$(source).find(">ul:first");var c={"root":{}};var b=new kityminder.Minder({renderTo:target});c.root=MM_FUNCS.li2jsonData(d.children("li:first"));b.importData("json",JSON.stringify(c));b.disable();b.execCommand("hand");$(d).hide()}};

